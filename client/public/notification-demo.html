<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LexiDraft - Real-time Notification Demo</title>
  <style>
    body {
      font-family: system-ui, -apple-system, sans-serif;
      margin: 0;
      padding: 20px;
      color: #333;
      background-color: #f9fafb;
    }
    
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      padding:, 20px;
    }
    
    h1 {
      color: #4f46e5;
      margin-top: 0;
    }
    
    .status-panel {
      background-color: #f3f4f6;
      border-radius: 6px;
      padding: 15px;
      margin-bottom: 20px;
    }
    
    .status-indicator {
      display: inline-block;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-right: 8px;
    }
    
    .status-connected {
      background-color: #10b981;
    }
    
    .status-disconnected {
      background-color: #ef4444;
    }
    
    button {
      background-color: #4f46e5;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 500;
      transition: background-color 0.2s;
      margin: 5px;
    }
    
    button:hover {
      background-color: #4338ca;
    }
    
    button:disabled {
      background-color: #9ca3af;
      cursor: not-allowed;
    }
    
    .notification-list {
      margin-top: 20px;
      max-height: 400px;
      overflow-y: auto;
      border: 1px solid #e5e7eb;
      border-radius: 6px;
    }
    
    .notification {
      padding: 12px 15px;
      border-bottom: 1px solid #e5e7eb;
      transition: background-color 0.2s;
    }
    
    .notification:last-child {
      border-bottom: none;
    }
    
    .notification.unread {
      background-color: #eff6ff;
    }
    
    .notification:hover {
      background-color: #f9fafb;
    }
    
    .notification-title {
      font-weight: 600;
      margin-bottom: 4px;
    }
    
    .notification-message {
      color: #4b5563;
      margin-bottom: 6px;
    }
    
    .notification-time {
      font-size: 12px;
      color: #6b7280;
    }
    
    .notification-controls {
      margin-top: 10px;
      text-align: right;
    }
    
    .notification-types {
      display: flex;
      gap: 10px;
      margin: 20px 0;
    }
    
    .empty-message {
      text-align: center;
      padding: 40px 0;
      color: #6b7280;
    }
    
    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 20px;
    }
    
    .logo-icon {
      background-color: #4f46e5;
      color: white;
      width: 40px;
      height: 40px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
    }
    
    .logo-text {
      font-size: 1.5rem;
      font-weight: 700;
      color: #111827;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="logo">
      <div class="logo-icon">LD</div>
      <div class="logo-text">LexiDraft</div>
    </div>
    
    <h1>Real-time Notification Demo</h1>
    
    <div class="status-panel">
      <div>
        <span class="status-indicator status-disconnected" id="connection-status"></span>
        <span id="status-text">Disconnected</span>
      </div>
      <div id="connection-details"></div>
    </div>
    
    <div>
      <button id="connect-btn">Connect to Notification Service</button>
      <button id="disconnect-btn" disabled>Disconnect</button>
    </div>
    
    <div class="notification-types">
      <button id="contract-btn" disabled>Contract Update</button>
      <button id="payment-btn" disabled>Payment Reminder</button>
      <button id="security-btn" disabled>Security Alert</button>
    </div>
    
    <div class="notification-list" id="notification-container">
      <div class="empty-message">No notifications yet. Connect to start receiving updates.</div>
    </div>
    
    <div class="notification-controls">
      <button id="clear-btn">Clear All</button>
    </div>
  </div>
  
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Elements
      const connectBtn = document.getElementById('connect-btn');
      const disconnectBtn = document.getElementById('disconnect-btn');
      const contractBtn = document.getElementById('contract-btn');
      const paymentBtn = document.getElementById('payment-btn');
      const securityBtn = document.getElementById('security-btn');
      const clearBtn = document.getElementById('clear-btn');
      const statusIndicator = document.getElementById('connection-status');
      const statusText = document.getElementById('status-text');
      const connectionDetails = document.getElementById('connection-details');
      const notificationContainer = document.getElementById('notification-container');
      
      // WebSocket connection
      let socket = null;
      
      // Connect to WebSocket server
      connectBtn.addEventListener('click', () => {
        const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
        const wsUrl = `${protocol}//${window.location.host}/ws`;
        
        // Create WebSocket connection
        socket = new WebSocket(wsUrl);
        
        socket.onopen = () => {
          // Update UI
          statusIndicator.classList.remove('status-disconnected');
          statusIndicator.classList.add('status-connected');
          statusText.textContent = 'Connected';
          connectionDetails.textContent = `Connected to ${wsUrl}`;
          
          // Update buttons
          connectBtn.disabled = true;
          disconnectBtn.disabled = false;
          contractBtn.disabled = false;
          paymentBtn.disabled = false;
          securityBtn.disabled = false;
          
          // Send authentication message (using a fake token for demo)
          socket.send(JSON.stringify({
            type: 'authenticate',
            token: 'fake-auth-token-for-demo'
          }));
          
          // Clear empty message
          notificationContainer.innerHTML = '';
        };
        
        socket.onclose = () => {
          handleDisconnection();
        };
        
        socket.onerror = (error) => {
          console.error('WebSocket error:', error);
          handleDisconnection();
        };
        
        socket.onmessage = (event) => {
          try {
            const data = JSON.parse(event.data);
            console.log('Received message:', data);
            
            if (data.type === 'notification') {
              addNotification(data.notification);
            } else if (data.type === 'auth_success') {
              connectionDetails.textContent += ' (Authenticated)';
            } else if (data.type === 'info') {
              console.log('Server info:', data.message);
            }
          } catch (error) {
            console.error('Error parsing message:', error);
          }
        };
      });
      
      // Disconnect from WebSocket server
      disconnectBtn.addEventListener('click', () => {
        if (socket) {
          socket.close();
          handleDisconnection();
        }
      });
      
      // Handle disconnection state
      function handleDisconnection() {
        // Update UI
        statusIndicator.classList.remove('status-connected');
        statusIndicator.classList.add('status-disconnected');
        statusText.textContent = 'Disconnected';
        connectionDetails.textContent = '';
        
        // Update buttons
        connectBtn.disabled = false;
        disconnectBtn.disabled = true;
        contractBtn.disabled = true;
        paymentBtn.disabled = true;
        securityBtn.disabled = true;
        
        // Clear socket
        socket = null;
      }
      
      // Clear all notifications
      clearBtn.addEventListener('click', () => {
        notificationContainer.innerHTML = '';
        if (notificationContainer.childElementCount === 0) {
          notificationContainer.innerHTML = '<div class="empty-message">No notifications yet.</div>';
        }
      });
      
      // Test notification - Contract Update
      contractBtn.addEventListener('click', () => {
        if (!socket) return;
        
        // Simulate sending a contract update notification to the server
        // In a real implementation, the server would broadcast this to relevant clients
        addNotification({
          id: Date.now(),
          title: 'Contract Update',
          message: 'Your Service Agreement with ABC Corp has been updated with new terms.',
          type: 'info',
          createdAt: new Date().toISOString(),
          read: false,
          actionUrl: '#contract-123'
        });
      });
      
      // Test notification - Payment Reminder
      paymentBtn.addEventListener('click', () => {
        if (!socket) return;
        
        // Simulate a payment reminder notification
        addNotification({
          id: Date.now(),
          title: 'Payment Reminder',
          message: 'Your subscription payment is due in 3 days. Please update your payment method.',
          type: 'warning',
          createdAt: new Date().toISOString(),
          read: false,
          actionUrl: '#payment'
        });
      });
      
      // Test notification - Security Alert
      securityBtn.addEventListener('click', () => {
        if (!socket) return;
        
        // Simulate a security alert notification
        addNotification({
          id: Date.now(),
          title: 'Security Alert',
          message: 'A new login was detected from an unknown device. Please verify this activity.',
          type: 'error',
          createdAt: new Date().toISOString(),
          read: false,
          actionUrl: '#security'
        });
      });
      
      // Add notification to the UI
      function addNotification(notification) {
        // Remove empty message if present
        const emptyMessage = notificationContainer.querySelector('.empty-message');
        if (emptyMessage) {
          emptyMessage.remove();
        }
        
        // Create notification element
        const notificationEl = document.createElement('div');
        notificationEl.className = `notification ${notification.read ? '' : 'unread'}`;
        notificationEl.dataset.id = notification.id;
        
        // Format time
        const createdAt = new Date(notification.createdAt);
        const timeFormatted = formatRelativeTime(createdAt);
        
        // Set notification content
        notificationEl.innerHTML = `
          <div class="notification-title">${notification.title}</div>
          <div class="notification-message">${notification.message}</div>
          <div class="notification-time">${timeFormatted}</div>
        `;
        
        // Mark as read on click
        notificationEl.addEventListener('click', () => {
          notificationEl.classList.remove('unread');
        });
        
        // Add to container
        notificationContainer.prepend(notificationEl);
      }
      
      // Format relative time (e.g., "5 minutes ago")
      function formatRelativeTime(date) {
        const now = new Date();
        const diffSeconds = Math.floor((now - date) / 1000);
        
        if (diffSeconds < 60) return 'just now';
        
        const diffMinutes = Math.floor(diffSeconds / 60);
        if (diffMinutes < 60) return `${diffMinutes} ${diffMinutes === 1 ? 'minute' : 'minutes'} ago`;
        
        const diffHours = Math.floor(diffMinutes / 60);
        if (diffHours < 24) return `${diffHours} ${diffHours === 1 ? 'hour' : 'hours'} ago`;
        
        const diffDays = Math.floor(diffHours / 24);
        if (diffDays < 30) return `${diffDays} ${diffDays === 1 ? 'day' : 'days'} ago`;
        
        const diffMonths = Math.floor(diffDays / 30);
        if (diffMonths < 12) return `${diffMonths} ${diffMonths === 1 ? 'month' : 'months'} ago`;
        
        const diffYears = Math.floor(diffMonths / 12);
        return `${diffYears} ${diffYears === 1 ? 'year' : 'years'} ago`;
      }
    });
  </script>
</body>
</html>